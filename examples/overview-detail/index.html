<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BCastView Demo - Overview-Detail Coordinator</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.27.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.17.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.24.0"></script>
  </head>
  <body>
    <p>Registered Worker: 0</p>

    <br />

    <a href="javascript:createOD()">Create the Overview-Detail</a><br />

    <br />

    <a href="javascript:broadcastClose()">Close All Workers</a><br />

    <script type="module">
      import { ViewCoordinator } from "../../dist/index.js";

      const coordinator = new ViewCoordinator();

      let previousViewCount = 0;

      window.broadcastClose = () => {
        coordinator.broadcastData("close");
      };

      window.createDetail = () => {
        window.open(
          `./detail-worker.html`,
          Math.random().toString(),
          `width=400,height=400,top=0,left=0`
        );
      };

      window.createOverview = () => {
        window.open(
          `./overview-worker.html`,
          Math.random().toString(),
          `width=400,height=400,top=500,left=0`
        );
      };

      window.createOD = () => {
        window.createOverview();
        window.createDetail();
      };

      setInterval(() => {
        if (previousViewCount > coordinator.viewManager.views.size) {
          window.broadcastClose();
        }

        document.querySelector(
          "p"
        ).innerText = `Registered Worker: ${coordinator.viewManager.views.size}`;

        previousViewCount = coordinator.viewManager.views.size;
      }, 10);
    </script>
  </body>
</html>
